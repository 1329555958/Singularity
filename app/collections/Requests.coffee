Collection = require './collection'

MOCK_JSON = [{"command":null,"name":"WaterfallService:1028:web:1384198454854","executor":"/home/tpetr/mesos/bin/hubspot-mesos-executor","resources":{"cpus":1,"memoryMb":512,"numPorts":3},"schedule":null,"instances":2,"daemon":true,"env":null,"uris":null,"executorData":{"cmd":"java -Xmx1g -Djava.net.preferIPv4Stack=true -jar $JAR_NAME server $CONFIG_YAML","uris":["http://hubspot.com.s3.amazonaws.com/build_artifacts/Waterfall/Waterfall-1028-2013-11-07_13-55-15.tar.gz?AWSAccessKeyId=1JBPVR3ZRKYRTDP6S4G2&Expires=1415734455&Signature=ManP9yLeW367bu7sJyCqatvlA7s%3D","http://hubspot.deploy.config.s3.amazonaws.com/Waterfall/1028/config.yaml?AWSAccessKeyId=1JBPVR3ZRKYRTDP6S4G2&Expires=1415734454&Signature=o1GImmPU6wGNHPMUiHt6Kw%2BiOZE%3D"],"env":{"DEPLOY_PROJECT_NAME":"WaterfallService","DEPLOY_USER":"tpetr@hubspot.com","DEPLOY_ID":"92e03042-9116-46c7-b5ba-8060fe93d52e","DEPLOY_TIME":"1384198455005"}},"rackSensitive":null},{"command":null,"name":"hspypi_web-purge","executor":"/home/tpetr/mesos/bin/hubspot-mesos-executor","resources":{"cpus":1,"memoryMb":512,"numPorts":0},"schedule":"0 30 0 ? * Sat","instances":1,"daemon":false,"env":null,"uris":null,"executorData":{"cmd":"django-admin.py purge_old_releases --settings hspypi_web.settings","uris":["http://hubspot.com.s3.amazonaws.com/build_artifacts/hspypi_web/hspypi_web-316-2013-11-10_13-36-37.tar.gz?AWSAccessKeyId=1JBPVR3ZRKYRTDP6S4G2&Expires=1415726274&Signature=1o9P4FBQw6tCFwBKOkaMeLUD3ko%3D","http://hubspot.deploy.config.s3.amazonaws.com/hspypi_web/316/config.yaml?AWSAccessKeyId=1JBPVR3ZRKYRTDP6S4G2&Expires=1415726273&Signature=xC7eRb6mgWT4t9ewVTX685yfxJs%3D"],"env":{"DEPLOY_PROJECT_NAME":"hspypi_web","DEPLOY_USER":"tpetr@hubspot.com","DEPLOY_ID":"e605113e-3fcd-485c-9f9a-5be32a20bf53","DEPLOY_TIME":"1384190274057"}},"rackSensitive":null},{"command":null,"name":"hspypi_web:316:web:1384190273465","executor":"/home/tpetr/mesos/bin/hubspot-mesos-executor","resources":{"cpus":1,"memoryMb":512,"numPorts":3},"schedule":null,"instances":1,"daemon":true,"env":null,"uris":null,"executorData":{"cmd":"./start_gunicorn hspypi_web.settings","uris":["http://hubspot.com.s3.amazonaws.com/build_artifacts/hspypi_web/hspypi_web-316-2013-11-10_13-36-37.tar.gz?AWSAccessKeyId=1JBPVR3ZRKYRTDP6S4G2&Expires=1415726273&Signature=RFQZGXDoNbrEgnpRp%2FqdAvh4xjQ%3D","http://hubspot.deploy.config.s3.amazonaws.com/hspypi_web/316/config.yaml?AWSAccessKeyId=1JBPVR3ZRKYRTDP6S4G2&Expires=1415726273&Signature=xC7eRb6mgWT4t9ewVTX685yfxJs%3D"],"env":{"DEPLOY_PROJECT_NAME":"hspypi_web","DEPLOY_USER":"tpetr@hubspot.com","DEPLOY_ID":"b0ed7f8f-16a6-431c-bfda-67903cf5b995","DEPLOY_TIME":"1384190273744"}},"rackSensitive":null},{"command":null,"name":"tqdash_web:94:web:1384108270295","executor":"/home/tpetr/mesos/bin/hubspot-mesos-executor","resources":{"cpus":1,"memoryMb":512,"numPorts":3},"schedule":null,"instances":1,"daemon":true,"env":null,"uris":null,"executorData":{"cmd":"./start_gunicorn tqdash_web.settings","uris":["http://hubspot.com.s3.amazonaws.com/build_artifacts/tqdash_web_proc/tqdash_web_proc-94-2013-11-10_13-23-48.tar.gz?AWSAccessKeyId=1JBPVR3ZRKYRTDP6S4G2&Expires=1415644270&Signature=XySOWdFv0klLMzYdb2ZqXEfcNhI%3D","http://hubspot.deploy.config.s3.amazonaws.com/tqdash_web_proc/94/config.yaml?AWSAccessKeyId=1JBPVR3ZRKYRTDP6S4G2&Expires=1415644270&Signature=uUjoj9OILfJbWmTLMQgC7Z5kZP0%3D"],"env":{"DEPLOY_PROJECT_NAME":"tqdash_web","DEPLOY_USER":"tpetr@hubspot.com"}},"rackSensitive":null},{"command":null,"name":"deployer_ui:80:web:1384190642340","executor":"/home/tpetr/mesos/bin/hubspot-mesos-executor","resources":{"cpus":1,"memoryMb":512,"numPorts":3},"schedule":null,"instances":1,"daemon":true,"env":null,"uris":null,"executorData":{"cmd":"node server.js","uris":["http://hubspot.com.s3.amazonaws.com/build_artifacts/DeployerUI/DeployerUI-80-2013-11-10_14-00-09.tar.gz?AWSAccessKeyId=1JBPVR3ZRKYRTDP6S4G2&Expires=1415726642&Signature=1co8P030OWAk9J5nawW7Y5b3vL4%3D","http://hubspot.deploy.config.s3.amazonaws.com/DeployerUI/80/config.yaml?AWSAccessKeyId=1JBPVR3ZRKYRTDP6S4G2&Expires=1415726642&Signature=aieVAm3wgG7riJo45mYB0bI3NZw%3D"],"env":{"DEPLOY_PROJECT_NAME":"deployer_ui","DEPLOY_USER":"tpetr@hubspot.com","DEPLOY_ID":"d58eaabf-8fef-466e-b3ac-af65a28f34c4","DEPLOY_TIME":"1384190642542"}},"rackSensitive":null},{"command":null,"name":"marathon_test:1259:web:1384190886412","executor":"/home/tpetr/mesos/bin/hubspot-mesos-executor","resources":{"cpus":1,"memoryMb":512,"numPorts":3},"schedule":null,"instances":1,"daemon":true,"env":null,"uris":null,"executorData":{"cmd":"java -Xmx1024m -jar ./target/ExampleDropWizardService-2.0-SNAPSHOT.jar server $CONFIG_YAML","uris":["http://hubspot.com.s3.amazonaws.com/build_artifacts/ExampleDropWizardService/ExampleDropWizardService-1259-2013-11-11_03-29-45.tar.gz?AWSAccessKeyId=1JBPVR3ZRKYRTDP6S4G2&Expires=1415726886&Signature=I%2Bjrnt3sXmCKZy%2BeNpUg3iTox9U%3D","http://hubspot.deploy.config.s3.amazonaws.com/ExampleDropWizardService/1259/config.yaml?AWSAccessKeyId=1JBPVR3ZRKYRTDP6S4G2&Expires=1415726886&Signature=EKpeACUYPvlIo69KgZakHZrMers%3D"],"env":{"DEPLOY_PROJECT_NAME":"marathon_test","DEPLOY_USER":"tpetr@hubspot.com","DEPLOY_ID":"df23e927-3084-4410-a364-8806744a0961","DEPLOY_TIME":"1384190886570"}},"rackSensitive":null},{"command":null,"name":"WaterfallPersister-singularity-waterfall-persister","executor":"/home/tpetr/mesos/bin/hubspot-mesos-executor","resources":{"cpus":1,"memoryMb":512,"numPorts":0},"schedule":"0 */1 * * * ?","instances":1,"daemon":false,"env":null,"uris":null,"executorData":{"cmd":"hadoop jar $JOB_JAR $RUNNER_CLASS -waterfall-puller -s3 -mt -rn waterfall-puller -an $BUCKET -osp $BUCKET -pl waterfall-puller -ik -iv 900 -nr $NUM_REDUCERS -hb -ch 1000","uris":["http://hubspot.com.s3.amazonaws.com/build_artifacts/Waterfall/Waterfall-1028-2013-11-07_13-55-15.tar.gz?AWSAccessKeyId=1JBPVR3ZRKYRTDP6S4G2&Expires=1415743912&Signature=YYOh1CCNHy3LQYiqftMvueO3tB4%3D","http://hubspot.deploy.config.s3.amazonaws.com/WaterfallPersister-singularity/1028/1384207911453/config.yaml?AWSAccessKeyId=1JBPVR3ZRKYRTDP6S4G2&Expires=1415743912&Signature=OQPCmz6MAmfRPE40MXLDL94CJHw%3D"],"env":{"DEPLOY_PROJECT_NAME":"WaterfallPersister-singularity","DEPLOY_USER":"tpetr@hubspot.com","DEPLOY_ID":"360e9df4-0b2b-4467-b4c7-4b0f1228b503","DEPLOY_TIME":"1384207912712"}},"rackSensitive":null},{"command":null,"name":"KumongaService:2665:web:1384190786065","executor":"/home/tpetr/mesos/bin/hubspot-mesos-executor","resources":{"cpus":1,"memoryMb":512,"numPorts":3},"schedule":null,"instances":1,"daemon":true,"env":null,"uris":null,"executorData":{"cmd":"java -Xmx1024m -jar ./KumongaService/target/KumongaService-1.0-SNAPSHOT.jar server $CONFIG_YAML","uris":["http://hubspot.com.s3.amazonaws.com/build_artifacts/Kumonga/Kumonga-2665-2013-11-11_03-33-56.tar.gz?AWSAccessKeyId=1JBPVR3ZRKYRTDP6S4G2&Expires=1415726786&Signature=gQeEh1iTue0iQ1yeNZeSm6vBGxg%3D","http://hubspot.deploy.config.s3.amazonaws.com/Kumonga/2665/config.yaml?AWSAccessKeyId=1JBPVR3ZRKYRTDP6S4G2&Expires=1415726786&Signature=NCVvWmWBI%2BCUrbZu9MhEnjGYbjI%3D"],"env":{"DEPLOY_PROJECT_NAME":"KumongaService","DEPLOY_USER":"tpetr@hubspot.com","DEPLOY_ID":"46549fca-cc34-4638-a3e8-c738afbb4095","DEPLOY_TIME":"1384190786252"}},"rackSensitive":null},{"command":null,"name":"Gamera:1086:web:1384190422867","executor":"/home/tpetr/mesos/bin/hubspot-mesos-executor","resources":{"cpus":1,"memoryMb":512,"numPorts":3},"schedule":null,"instances":1,"daemon":true,"env":null,"uris":null,"executorData":{"cmd":"java -Xmx1024m -jar target/Gamera-1.0-dw-SNAPSHOT.jar server $CONFIG_YAML","uris":["http://hubspot.com.s3.amazonaws.com/build_artifacts/Gamera/Gamera-1086-2013-11-11_12-09-18.tar.gz?AWSAccessKeyId=1JBPVR3ZRKYRTDP6S4G2&Expires=1415726423&Signature=eSmO0RmD7MadhKYqF05beVnqqfw%3D","http://hubspot.deploy.config.s3.amazonaws.com/Gamera/1086/config.yaml?AWSAccessKeyId=1JBPVR3ZRKYRTDP6S4G2&Expires=1415726422&Signature=pMXK55CZyfwHEp9zzkWKoTwRzss%3D"],"env":{"DEPLOY_PROJECT_NAME":"Gamera","DEPLOY_USER":"tpetr@hubspot.com","DEPLOY_ID":"715da0b4-3951-4535-88b1-7d0cdc509286","DEPLOY_TIME":"1384190423028"}},"rackSensitive":null}]

class Requests extends Collection

    #url: "http://#{env.SINGULARITY_BASE}/#{constants.api_base}/request"
    url: => "https://#{env.INTERNAL_BASE}/#{constants.kumonga_api_base}/users/#{app.login.context.user.email}/settings"

    parse: (requests) ->
        requests = MOCK_JSON

        _.each requests, (request, i) =>
            request.id = request.name
            request.label = @parseLabelFromName request.name
            request.deployUser = @parseDeployUser request
            request.JSONString = utils.stringJSON request
            requests[i] = request

        requests

    parseLabelFromName: (name) ->
        name.split(':')[0]

    parseDeployUser: (request) ->
        (request.executorData?.env?.DEPLOY_USER ? '').split('@')[0]

    comparator: 'name'

module.exports = Requests